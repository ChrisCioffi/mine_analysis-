#creates a count with the row name being count. The n value is the number of times it occurs
summarise(history_of_violations = sum(history_viol), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure), good_faith = sum(good_faith), total_assess = sum(total_assess),  total_paid = sum(total_paid))  %>%
arrange(desc(total_fine))
mine_and_fines <- novo_w_names  %>%
group_by(siteName) %>%
#creates a count with the row name being count. The n value is the number of times it occurs
summarise(history_of_violations = sum(history_viol), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure), good_faith = sum(good_faith), total_assess = sum(total_assess),  total_paid = sum(total_paid))  %>%
arrange(desc(total_fine))
mines_forfeit <- novo_w_names %>%
group_by(siteName, penalty_status) %>%
summarise(count =n())
novo_and_fines <- novo_w_names  %>%
group_by(NOVO_num, Date, permittee, siteName ) %>%
#creates a count with the row name being count. The n value is the number of times it occurs
summarise(history_of_violations = sum(history_viol), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure), good_faith = sum(good_faith), total_assess = sum(total_assess),  total_paid = sum(total_paid))  %>%
arrange(desc(total_fine))
View(novo_and_fines)
#so first I wanted to look at the violation number and the date and see how much each company owed per novo.
novo_and_fines <- novo_w_names  %>%
group_by(NOVO_num, Date, permittee, siteName ) %>%
#creates a count with the row name being count. The n value is the number of times it occurs
summarise(history_of_violations = sum(history_viol), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure), good_faith = sum(good_faith), total_assess = sum(total_assess),  total_paid = sum(total_paid))  %>%
arrange(desc(NOVO_num, Date))
#so first I wanted to look at the violation number and the date and see how much each company owed per novo.
novo_and_fines <- novo_w_names  %>%
group_by(NOVO_num, Date, permittee, siteName ) %>%
#creates a count with the row name being count. The n value is the number of times it occurs
summarise(history_of_violations = sum(history_viol), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure), good_faith = sum(good_faith), total_assess = sum(total_assess),  total_paid = sum(total_paid))  %>%
arrange(desc(Date, NOVO_num))
#so first I wanted to look at the violation number and the date and see how much each company owed per novo.
novo_and_fines <- novo_w_names  %>%
group_by(NOVO_num, Date, permittee, siteName ) %>%
#creates a count with the row name being count. The n value is the number of times it occurs
summarise(history_of_violations = sum(history_viol), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure), good_faith = sum(good_faith), total_assess = sum(total_assess),  total_paid = sum(total_paid))  %>%
arrange(desc(Date, permittee, siteName))
#so first I wanted to look at the violation number and the date and see how much each company owed per novo.
novo_and_fines <- novo_w_names  %>%
group_by(NOVO_num, Date, permittee, siteName ) %>%
#creates a count with the row name being count. The n value is the number of times it occurs
summarise(history_of_violations = sum(history_viol), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure), good_faith = sum(good_faith), total_assess = sum(total_assess),  total_paid = sum(total_paid))  %>%
arrange(desc(Date, siteName))
mine_and_fines <- novo_w_names  %>%
group_by(siteName) %>%
#creates a count with the row name being count. The n value is the number of times it occurs
summarise(history_of_violations = sum(history_viol), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure), good_faith = sum(good_faith), total_assess = sum(total_assess),  total_paid = sum(total_paid))  %>%
arrange(desc(total_fine))
View(mine_and_fines)
View(mines_forfeit)
company_and_fines <- novo_w_names  %>%
group_by(permittee, siteName , Permit_no.x) %>%
#creates a count with the row name being count. The n value is the number of times it occurs
summarise(history_of_violations = sum(history_viol), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure), good_faith = sum(good_faith), total_assess = sum(total_assess),  total_paid = sum(total_paid))  %>%
arrange(desc(total_fine))
View(company_and_fines)
#so first, I tried to pull in all of the inspections I got from my first FOIA request. It didn't really go well, but I am going to be able to use the permit names from it
#inspection_reports <- read.csv('mine_inspections_current.csv')
#now i group and count by the permit and site name so I can join below
#mine_names <- inspection_reports %>%
#  group_by(siteName, permit) %>%
#  summarise(count = n())
#theres a few doibles and one to check. I'm going to write this to a CSV and quickly edit the documemnt.
#write_csv(mine_names, "minenames.csv")
#now I've corrected the few duplicates. And read it back in. We should be good.
mine_names <- read_csv("minenames.csv")
#here are the two databases I've built. the novo_full is all of the novos and its fines.
Novo_full <- read_csv("full_novos.csv")
#the novo_log is the dept. of mines-pfrivided
Novo_log <- read_csv("Novo_log.csv")
# A quick function I found online that trims out pesky white spaces, which has made joining a little tricky.
trim <- function (x) gsub("^\\s+|\\s+$", "", x)
Novo_log$Permit_no <- trim(Novo_log$Permit_no)
Novo_full$NOVO_num <- trim(Novo_full$NOVO_num)
Novo_log$NOVO_num <- trim(Novo_log$NOVO_num)
#now I'm joining the sheets I've devised. The mine log, which is each novo and the mine number. And the Novo_full whicch is a log of all violations.
novo_all <- left_join(Novo_full, Novo_log, by = c("NOVO_num" = "NOVO_num"))
#Now we can have a CSV copy, if needed.
#write_csv(novo_all, "novo_all.csv")
#now I want to join another sheet that I've created. above mine_names. It has the specific mine names...I didn't take that information down when I was making my database.
novo_w_names <- left_join(novo_all, mine_names, by = c("Permit_no.x" ="permit" ))
#so first I wanted to look at the violation number and the date and see how much each company owed per novo.
novo_and_fines <- novo_w_names  %>%
group_by(NOVO_num, Date, permittee, siteName ) %>%
#creates a count with the row name being count. The n value is the number of times it occurs
summarise(history_of_violations = sum(history_viol), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure), good_faith = sum(good_faith), total_assess = sum(total_assess),  total_paid = sum(total_paid))  %>%
arrange(desc( siteName))
#NOw I want to look at each company and how many fines they racked up
company_and_fines <- novo_w_names  %>%
group_by(permittee, siteName , Permit_no.x) %>%
#creates a count with the row name being count. The n value is the number of times it occurs
summarise(history_of_violations = sum(history_viol), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure), good_faith = sum(good_faith), total_assess = sum(total_assess),  total_paid = sum(total_paid))  %>%
arrange(desc(total_fine))
#NOw I want to look at each company and how many fines they racked up,
company_and_fines <- novo_w_names  %>%
group_by(permittee, siteName) %>%
#creates a count with the row name being count. The n value is the number of times it occurs
summarise(history_of_violations = sum(history_viol), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure), good_faith = sum(good_faith), total_assess = sum(total_assess),  total_paid = sum(total_paid))  %>%
arrange(desc(total_fine))
company_and_fines <- novo_w_names  %>%
group_by(permittee) %>%
#creates a count with the row name being count. The n value is the number of times it occurs
summarise(history_of_violations = sum(history_viol), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure), good_faith = sum(good_faith), total_assess = sum(total_assess),  total_paid = sum(total_paid))  %>%
arrange(desc(total_fine))
company_and_fines <- novo_w_names  %>%
group_by(permittee, siteName) %>%
#creates a count with the row name being count. The n value is the number of times it occurs
summarise(history_of_violations = sum(history_viol), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure), good_faith = sum(good_faith), total_assess = sum(total_assess),  total_paid = sum(total_paid))  %>%
arrange(desc(total_fine))
novo_and_fines <- novo_w_names  %>%
group_by(NOVO_num, Date, permittee, siteName ) %>%
#creates a count with the row name being count. The n value is the number of times it occurs
summarise(history_of_violations = sum(history_viol), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure), good_faith = sum(good_faith), total_assess = sum(total_assess),  total_paid = sum(total_paid))  %>%
arrange(desc( siteName))
if_else(novo_w_names$good_faith > 0, "no_fine", "fine")
View(novo_w_names)
#now let's see how many times there was no good faith money off and when there was.
#To do this Im making a small ifelse row to show when there's no good faith and when there is.
if_else(novo_w_names$good_faith < 0, "no_fine", "fine")
#now let's see how many times there was no good faith money off and when there was.
#To do this Im making a small ifelse row to show when there's no good faith and when there is.
if_else(novo_w_names$good_faith < .1, "no_fine", "fine")
#now let's see how many times there was no good faith money off and when there was.
#To do this Im making a small ifelse row to show when there's no good faith and when there is.
if_else(novo_w_names$good_faith <= -.1 , "good_faith", "no_good_faith")
novo_w_names <- mutate( goodfaith_yesno = if_else(novo_w_names$good_faith <= -.1 , "good_faith", "no_good_faith"))
novo_w_names <- mutate(novo_w_names, goodfaith_yesno = if_else(novo_w_names$good_faith <= -.1 , "good_faith", "no_good_faith"))
summarise( count = n())
good_faith_yesno <- novo_w_names %>%
group_by(permittee, siteName, goodfaith_yesno) %>%
summarise(count = n())
View(good_faith_yesno)
good_faith_yesno <- novo_w_names %>%
group_by(permittee, siteName, goodfaith_yesno) %>%
summarise(count = n(), sum(good_faith), sum(total_assess))
good_faith_yesno <- novo_w_names %>%
group_by(permittee, siteName, goodfaith_yesno) %>%
summarise(count = n(), good_faith = sum(good_faith), total_assess = sum(total_assess),  total_paid = sum(total_paid))
good_faith_yesno <- novo_w_names %>%
group_by(permittee, siteName, goodfaith_yesno) %>%
summarise(count = n(), good_faith = sum(good_faith), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure),  total_paid = sum(total_paid))
good_faith_yesno <- novo_w_names %>%
group_by(permittee, goodfaith_yesno) %>%
summarise(count = n())
good_faith_yesno <- novo_w_names %>%
group_by(siteName, goodfaith_yesno) %>%
summarise(count = n())
#NOw I want to look at each company and how many fines they racked up...
company_and_fines <- novo_w_names  %>%
group_by(permittee, NOVO_num, siteName) %>%
#creates a count with the row name being count. The n value is the number of times it occurs
summarise(history_of_violations = sum(history_viol), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure), good_faith = sum(good_faith), total_assess = sum(total_assess),  total_paid = sum(total_paid))  %>%
arrange(desc(total_fine))
good_faith_yesno <- novo_w_names %>%
group_by(NOVO_num, goodfaith_yesno) %>%
summarise(count = n())
good_faith_yesno <- novo_w_names %>%
group_by(goodfaith_yesno) %>%
summarise(count = n())
good_faith_yesno <- novo_w_names %>%
filter(siteName != "Table Rock Mine")
group_by(goodfaith_yesno) %>%
summarise(count = n())
good_faith_yesno <- novo_w_names %>%
filter(siteName != "Table Rock Mine") %>%
group_by(goodfaith_yesno) %>%
summarise(count = n())
novo_and_fines <- novo_w_names  %>%
group_by(NOVO_num, Date, permittee, siteName ) %>%
#creates a count with the row name being count. The n value is the number of times it occurs
summarise(history_of_violations = sum(history_viol), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure), good_faith = sum(good_faith), total_assess = sum(total_assess),  total_paid = sum(total_paid))  %>%
arrange(desc( siteName))
View(novo_and_fines)
company_and_fines <- novo_w_names  %>%
group_by(permittee, siteName ) %>%
#creates a count with the row name being count. The n value is the number of times it occurs
summarise(history_of_violations = sum(history_viol), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure), good_faith = sum(good_faith), total_assess = sum(total_assess),  total_paid = sum(total_paid))  %>%
arrange(desc( siteName))
company_and_fines <- novo_w_names  %>%
group_by(permittee, siteName) %>%
#creates a count with the row name being count. The n value is the number of times it occurs
summarise(history_of_violations = sum(history_viol), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure), good_faith = sum(good_faith), total_assess = sum(total_assess),  total_paid = sum(total_paid))  %>%
arrange(desc(total_fine))
novo_and_fines <- novo_w_names  %>%
group_by(NOVO_num, Date, permittee, siteName ) %>%
#creates a count with the row name being count. The n value is the number of times it occurs
summarise(history_of_violations = sum(history_viol), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure), good_faith = sum(good_faith), total_assess = sum(total_assess),  total_paid = sum(total_paid))  %>%
arrange(desc( siteName))
mine_and_fines <- novo_w_names  %>%
group_by(siteName) %>%
#creates a count with the row name being count. The n value is the number of times it occurs
summarise(history_of_violations = sum(history_viol), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure), good_faith = sum(good_faith), total_assess = sum(total_assess),  total_paid = sum(total_paid))  %>%
arrange(desc(total_fine))
View(novo_w_names)
class(novo_w_names$received_date)
novo_w_names$received_date <- as.date(novo_w_names$received_date)
novo_w_names$received_date <- as.Date(novo_w_names$received_date)
novo_w_names <- left_join(novo_all, mine_names, by = c("Permit_no.x" ="permit" ))
novo_w_names %>%
group_by(violation_issued_fy)
novo_w_names %>%
group_by(violation_issued_fy) %>%
summarise(count = n())
novo_w_names %>%
group_by(violation_issued_fy) %>%
summarise(count = n(), sum(total_paid))
novo_w_names %>%
group_by(violation_issued_fy) %>%
summarise(count = n(), sum(total_paid, na.rm = T))
novo_w_names$received_date <- as.Date(novo_w_names$received_date ,"%m/%d/%y")
novo_yearpaid <- novo_w_names %>%
group_by(year)
novo_yearpaid <- novo_w_names$received_date %>%
group_by(year)
novo_yearpaid <- novo_w_names %>%
group_by(received_date, year)
novo_yearpaid <- novo_w_names %>%
group_by(received_date)
View(novo_yearpaid)
novo_w_names <- mutate(novo_w_names$received_date, year = '%y'))
novo_w_names <- mutate(novo_w_names$received_date, year = %y))
novo_w_names <- mutate(novo_w_names$received_date, year = "%y"))
novo_w_names <- mutate(novo_w_names$year = as.numeric(format(novo_w_names$received_date, "%Y"))
novo_w_names <- mutate(year = as.numeric(format(novo_w_names$received_date, "%Y"))
novo_w_names <- mutate(year = as.numeric(format(novo_w_names$received_date, "%Y")))
novo_w_names <- mutate(((month = format(received_date, "%m"), year = format(received_date, "%Y")
#Then I go ahead and create some columns to look at the months and years
novo_w_names <- mutate(month = format(received_date, "%m"), year = format(received_date, "%Y")))
#Then I go ahead and create some columns to look at the months and years
novo_w_names <- mutate(month = format(received_date, "%m"), year = format(received_date, "%Y"))
#Then I go ahead and create some columns to look at the months and years
novo_w_names <- mutate(month = format(novo_w_names$received_date, "%m"), year = format(novo_w_names$received_date, "%Y"))
novo_w_names <- mutate(novo_w_names, month = format(novo_w_names$received_date, "%m"), year = format(novo_w_names$received_date, "%Y"))
View(novo_w_names)
finespaid <- novo_w_names %>%
group_by(year)
summarise(history_of_violations = sum(history_viol), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure), good_faith = sum(good_faith), total_assess = sum(total_assess),  total_paid = sum(total_paid))
View(finespaid)
finespaid <- novo_w_names %>%
group_by(year)%>%
summarise(history_of_violations = sum(history_viol), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure), good_faith = sum(good_faith), total_assess = sum(total_assess),  total_paid = sum(total_paid))
finespaid <- novo_w_names %>%
group_by(year)%>%
summarise(history_of_violations = sum(history_viol), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure), good_faith = sum(good_faith), total_assess = sum(total_assess),  total_paid = sum(total_paid), count n= ())
finespaid <- novo_w_names %>%
group_by(year)%>%
summarise(history_of_violations = sum(history_viol), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure), good_faith = sum(good_faith), total_assess = sum(total_assess),  total_paid = sum(total_paid), count n = ())
finespaid <- novo_w_names %>%
group_by(year)%>%
summarise(count n =(),history_of_violations = sum(history_viol), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure), good_faith = sum(good_faith), total_assess = sum(total_assess),  total_paid = sum(total_paid))
finespaid <- novo_w_names %>%
group_by(year)%>%
summarise(history_of_violations = sum(history_viol), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure), good_faith = sum(good_faith), total_assess = sum(total_assess),  total_paid = sum(total_paid))
novo_w_names <- mutate(novo_w_names, fy = unlist(strsplit(id, split="of ")))
novo_w_names <- mutate(novo_w_names, fy = str_extract(id, "[^of]+$"))))
novo_w_names <- mutate(novo_w_names, fy = str_extract(id, "[^of]+$")))
novo_w_names <- mutate(novo_w_names, fy = str_extract(id, "[^of]+$"))
novo_w_names <- mutate(novo_w_names, fy = str_extract(id, "[^ ]+$"))
novo_w_names <- mutate(novo_w_names, fy = str_extract(id, "[ ]+$"))
novo_w_names <- mutate(novo_w_names, fy = str_extract(quarter_year_resolved, "[^of]+$"))
novo_fy <- novo_w_names %>%
group_by(fy) %>%
summarise(history_of_violations = sum(history_viol), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure), good_faith = sum(good_faith), total_assess = sum(total_assess),  total_paid = sum(total_paid))
View(novo_fy)
#now I can see which fiscal year fines were paid.
novo_fy <- novo_w_names %>%
group_by(fy) %>%
summarise(history_of_violations = sum(history_viol, na.rm = T), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure, na.rm = T), good_faith = sum(good_faith, na.rm = T), total_assess = sum(total_assess, na.rm = T),  total_paid = sum(total_paid, na.rm = T))
novo_fy <- novo_w_names %>%
filter(siteName != "Table Rock Mine") %>%
group_by(fy) %>%
summarise(history_of_violations = sum(history_viol, na.rm = T), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure, na.rm = T), good_faith = sum(good_faith, na.rm = T), total_assess = sum(total_assess, na.rm = T),  total_paid = sum(total_paid, na.rm = T))
#now I can see which fiscal year fines were paid. I'm removing table rock mine because the numbers are so high and the fines were never paid. So it just throws everything off.
novo_fy <- novo_w_names %>%
filter(siteName != "Table Rock Mine" | siteName != "Underwood Mine") %>%
group_by(fy) %>%
summarise(history_of_violations = sum(history_viol, na.rm = T), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure, na.rm = T), good_faith = sum(good_faith, na.rm = T), total_assess = sum(total_assess, na.rm = T),  total_paid = sum(total_paid, na.rm = T))
#now I can see which fiscal year fines were paid. I'm removing table rock mine because the numbers are so high and the fines were never paid. So it just throws everything off.
novo_fy <- novo_w_names %>%
filter(siteName != "Table Rock Mine" & siteName != "Underwood Mine") %>%
group_by(fy) %>%
summarise(history_of_violations = sum(history_viol, na.rm = T), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure, na.rm = T), good_faith = sum(good_faith, na.rm = T), total_assess = sum(total_assess, na.rm = T),  total_paid = sum(total_paid, na.rm = T))
novo_fy <- novo_w_names %>%
#filter(siteName != "Table Rock Mine" & siteName != "Underwood Mine") %>%
group_by(fy) %>%
summarise(history_of_violations = sum(history_viol, na.rm = T), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure, na.rm = T), good_faith = sum(good_faith, na.rm = T), total_assess = sum(total_assess, na.rm = T),  total_paid = sum(total_paid, na.rm = T))
View(novo_fy)
novo_w_names$Novo_date <- as.Date(novo_w_names$Novo_date, "%m/%d/%y")
#Now I want to see when these fines were paid. First I convert to the proper date
novo_w_names$received_date <- as.Date(novo_w_names$received_date ,"%m/%d/%y")
novo_w_names$Novo_date <- as.Date(novo_w_names$Novo_date, "%m/%d/%y")
#Then I go ahead and create some columns to look at the months and years
novo_w_names <- mutate(novo_w_names, novo_year = format(novo_w_names$Novo_date, "%Y"), received_year = format(novo_w_names$received_date, "%Y"))
library(tidyverse)
#so first, I tried to pull in all of the inspections I got from my first FOIA request. It didn't really go well, but I am going to be able to use the permit names from it
#inspection_reports <- read.csv('mine_inspections_current.csv')
#now i group and count by the permit and site name so I can join below
#mine_names <- inspection_reports %>%
#  group_by(siteName, permit) %>%
#  summarise(count = n())
#theres a few doibles and one to check. I'm going to write this to a CSV and quickly edit the documemnt.
#write_csv(mine_names, "minenames.csv")
#now I've corrected the few duplicates. And read it back in. We should be good.
mine_names <- read_csv("minenames.csv")
#here are the two databases I've built. the novo_full is all of the novos and its fines.
Novo_full <- read_csv("full_novos.csv")
#the novo_log is the dept. of mines-pfrivided
Novo_log <- read_csv("Novo_log.csv")
# A quick function I found online that trims out pesky white spaces, which has made joining a little tricky.
trim <- function (x) gsub("^\\s+|\\s+$", "", x)
Novo_log$Permit_no <- trim(Novo_log$Permit_no)
Novo_full$NOVO_num <- trim(Novo_full$NOVO_num)
Novo_log$NOVO_num <- trim(Novo_log$NOVO_num)
#now I'm joining the sheets I've devised. The mine log, which is each novo and the mine number. And the Novo_full whicch is a log of all violations.
novo_all <- left_join(Novo_full, Novo_log, by = c("NOVO_num" = "NOVO_num"))
#Now we can have a CSV copy, if needed.
#write_csv(novo_all, "novo_all.csv")
#now I want to join another sheet that I've created. above mine_names. It has the specific mine names...I didn't take that information down when I was making my database.
novo_w_names <- left_join(novo_all, mine_names, by = c("Permit_no.x" ="permit" ))
#Now I want to see when these fines were paid. First I convert to the proper date
novo_w_names$received_date <- as.Date(novo_w_names$received_date ,"%m/%d/%y")
novo_w_names$Novo_date <- as.Date(novo_w_names$Novo_date, "%m/%d/%y")
#Then I go ahead and create some columns to look at the months and years
novo_w_names <- mutate(novo_w_names, novo_year = format(novo_w_names$Novo_date, "%Y"), received_year = format(novo_w_names$received_date, "%Y"))
#now I can see how much was paid in each year
finespaid <- novo_w_names %>%
group_by(year)%>%
summarise(history_of_violations = sum(history_viol), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure), good_faith = sum(good_faith), total_assess = sum(total_assess),  total_paid = sum(total_paid))
#so What I didn't realize when I was doing the above calculations, it's in fiscal year, not actual year. So I wasn't getting acurate num,bers. Now I've gone back and used a regex to say match one or more (+) of the characters that aren't 'of' (the negating [^ ]), followed by end of string ($). her'es the stack ex I got it from https://stackoverflow.com/questions/41986730/create-new-column-with-dplyr-mutate-and-substring-of-existing-column
novo_w_names <- mutate(novo_w_names, fy = str_extract(quarter_year_resolved, "[^of]+$"))
#now I can see which fiscal year fines were paid. I decided to remove table rock mine and underwood because the numbers are so high and the fines were never paid. I can note it out if I want a total.
novo_fy <- novo_w_names %>%
#filter(siteName != "Table Rock Mine" & siteName != "Underwood Mine") %>%
group_by(fy) %>%
summarise(history_of_violations = sum(history_viol, na.rm = T), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure, na.rm = T), good_faith = sum(good_faith, na.rm = T), total_assess = sum(total_assess, na.rm = T),  total_paid = sum(total_paid, na.rm = T))
#so first I wanted to look at the violation number and the date and see how much each company owed per novo.
novo_and_fines <- novo_w_names  %>%
group_by(NOVO_num, Date, permittee, siteName ) %>%
#creates a count with the row name being count. The n value is the number of times it occurs
summarise(history_of_violations = sum(history_viol), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure), good_faith = sum(good_faith), total_assess = sum(total_assess),  total_paid = sum(total_paid))  %>%
arrange(desc( siteName))
#now let's see how many times there was no good faith money off and when there was.
#To do this Im making a small ifelse row to show when there's no good faith and when there is.
novo_w_names <- mutate(novo_w_names, goodfaith_yesno = if_else(novo_w_names$good_faith <= -.1 , "good_faith", "no_good_faith"))
# I removed the Table Rock Mine site, which was eventually forfeited by the company.
good_faith_yesno <- novo_w_names %>%
filter(siteName != "Table Rock Mine") %>%
group_by(goodfaith_yesno) %>%
summarise(count = n())
#NOw I want to look at each company and how many fines they racked up...
company_and_fines <- novo_w_names  %>%
group_by(permittee, siteName) %>%
#creates a count with the row name being count. The n value is the number of times it occurs
summarise(history_of_violations = sum(history_viol), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure), good_faith = sum(good_faith), total_assess = sum(total_assess),  total_paid = sum(total_paid))  %>%
arrange(desc(total_fine))
#now we're just looking at site names, or the mines themselves
mine_and_fines <- novo_w_names  %>%
group_by(siteName) %>%
#creates a count with the row name being count. The n value is the number of times it occurs
summarise(history_of_violations = sum(history_viol), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure), good_faith = sum(good_faith), total_assess = sum(total_assess),  total_paid = sum(total_paid))  %>%
arrange(desc(total_fine))
mines_forfeit <- novo_w_names %>%
group_by(siteName, penalty_status) %>%
summarise(count =n())
View(novo_all)
fines_issued <- novo_w_names %>%
group_by(novo_year) %>%
summarise(count(NOVO_num), history_of_violations = sum(history_viol, na.rm = T), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure, na.rm = T), good_faith = sum(good_faith, na.rm = T), total_assess = sum(total_assess, na.rm = T),  total_paid = sum(total_paid, na.rm = T))
fines_issued <- novo_w_names %>%
group_by(novo_year) %>%
count(NOVO_num) %>%
summarise( history_of_violations = sum(history_viol, na.rm = T), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure, na.rm = T), good_faith = sum(good_faith, na.rm = T), total_assess = sum(total_assess, na.rm = T),  total_paid = sum(total_paid, na.rm = T))
fines_issued <- novo_w_names %>%
group_by(novo_year) %>%
summarise( history_of_violations = sum(history_viol, na.rm = T), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure, na.rm = T), good_faith = sum(good_faith, na.rm = T), total_assess = sum(total_assess, na.rm = T),  total_paid = sum(total_paid, na.rm = T))
View(fines_issued)
fines_issued <- novo_w_names %>%
group_by(novo_fy) %>%
summarise( history_of_violations = sum(history_viol, na.rm = T), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure, na.rm = T), good_faith = sum(good_faith, na.rm = T), total_assess = sum(total_assess, na.rm = T),  total_paid = sum(total_paid, na.rm = T))
finespaid <- novo_w_names %>%
group_by(year)%>%
summarise(history_of_violations = sum(history_viol, na.rm = T), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure, na.rm = T), good_faith = sum(good_faith, na.rm = T), total_assess = sum(total_assess, na.rm = T),  total_paid = sum(total_paid, na.rm = T))
#now I can see how much was paid in each year
finespaid <- novo_w_names %>%
group_by(received_year)%>%
summarise(history_of_violations = sum(history_viol, na.rm = T), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure, na.rm = T), good_faith = sum(good_faith, na.rm = T), total_assess = sum(total_assess, na.rm = T),  total_paid = sum(total_paid, na.rm = T))
View(finespaid)
View(novo_fy)
novo_fy <- novo_w_names %>%
#filter(siteName != "Table Rock Mine" & siteName != "Underwood Mine") %>%
group_by(fy) %>%
summarise(history_of_violations = sum(history_viol, na.rm = T), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure, na.rm = T), good_faith = sum(good_faith, na.rm = T), total_assess = sum(total_assess, na.rm = T),  total_paid = sum(total_paid, na.rm = T))
novo_fy <- novo_w_names %>%
filter(siteName != "Table Rock Mine" & siteName != "Underwood Mine") %>%
group_by(fy) %>%
summarise(history_of_violations = sum(history_viol, na.rm = T), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure, na.rm = T), good_faith = sum(good_faith, na.rm = T), total_assess = sum(total_assess, na.rm = T),  total_paid = sum(total_paid, na.rm = T))
View(novo_fy)
novo_fy <- novo_w_names %>%
filter(siteName != "Table Rock Mine" & siteName != "Underwood Mine") %>%
group_by(fy) %>%
summarise(history_of_violations = sum(history_viol, na.rm = T), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure, na.rm = T), good_faith = sum(good_faith, na.rm = T), total_assess = sum(total_assess, na.rm = T),  total_paid = sum(total_paid, na.rm = T))
fines_issued <- novo_w_names %>%
group_by(violation_issued_fy) %>%
summarise( history_of_violations = sum(history_viol, na.rm = T), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure, na.rm = T), good_faith = sum(good_faith, na.rm = T), total_assess = sum(total_assess, na.rm = T),  total_paid = sum(total_paid, na.rm = T))
View(fines_issued)
novo_fy <- novo_w_names %>%
filter(siteName != "Table Rock Mine" & siteName != "Underwood Mine") %>%
group_by(fy) %>%
summarise(history_of_violations = sum(history_viol, na.rm = T), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure, na.rm = T), good_faith = sum(good_faith, na.rm = T), total_assess = sum(total_assess, na.rm = T),  total_paid = sum(total_paid, na.rm = T))
novo_fy <- novo_w_names %>%
filter(siteName != "Table Rock Mine" & siteName != "Underwood Mine") %>%
group_by(violation_issued_fy) %>%
summarise(history_of_violations = sum(history_viol, na.rm = T), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure, na.rm = T), good_faith = sum(good_faith, na.rm = T), total_assess = sum(total_assess, na.rm = T),  total_paid = sum(total_paid, na.rm = T))
#so first I wanted to look at the violation number and the date and see how much each company owed per novo.
novo_and_fines <- novo_w_names  %>%
group_by(NOVO_num, Date, permittee, siteName ) %>%
#creates a count with the row name being count. The n value is the number of times it occurs
summarise(history_of_violations = sum(history_viol), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure), good_faith = sum(good_faith), total_assess = sum(total_assess),  total_paid = sum(total_paid))  %>%
arrange(desc( siteName))
View(novo_and_fines)
#so first I wanted to look at the violation number and the date and see how much each company owed per novo.
novo_and_fines <- novo_w_names  %>%
group_by(NOVO_num, violation_issued_fy, permittee, siteName ) %>%
#creates a count with the row name being count. The n value is the number of times it occurs
summarise(history_of_violations = sum(history_viol), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure), good_faith = sum(good_faith), total_assess = sum(total_assess),  total_paid = sum(total_paid))  %>%
arrange(desc( siteName))
novo_and_fines <- novo_w_names  %>%
filter(siteName != "Table Rock Mine" & siteName != "Underwood Mine") %>%
group_by(NOVO_num, violation_issued_fy, permittee, siteName ) %>%
#creates a count with the row name being count. The n value is the number of times it occurs
summarise(history_of_violations = sum(history_viol), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure), good_faith = sum(good_faith), total_assess = sum(total_assess),  total_paid = sum(total_paid))  %>%
arrange(desc( siteName))
#now I can see which fiscal year fines were issued. I decided to remove table rock mine and underwood because the numbers are so high and the fines were never paid. I can note it out if I want a total.
novo_fy <- novo_w_names %>%
filter(siteName != "Table Rock Mine" & siteName != "Underwood Mine") %>%
group_by(violation_issued_fy, mine_names) %>%
summarise(history_of_violations = sum(history_viol, na.rm = T), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure, na.rm = T), good_faith = sum(good_faith, na.rm = T), total_assess = sum(total_assess, na.rm = T),  total_paid = sum(total_paid, na.rm = T))
#now I can see which fiscal year fines were issued. I decided to remove table rock mine and underwood because the numbers are so high and the fines were never paid. I can note it out if I want a total.
novo_fy <- novo_w_names %>%
filter(siteName != "Table Rock Mine" & siteName != "Underwood Mine") %>%
group_by(violation_issued_fy, siteName) %>%
summarise(history_of_violations = sum(history_viol, na.rm = T), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure, na.rm = T), good_faith = sum(good_faith, na.rm = T), total_assess = sum(total_assess, na.rm = T),  total_paid = sum(total_paid, na.rm = T))
novo_fy <- novo_w_names %>%
filter(siteName != "Table Rock Mine" & siteName != "Underwood Mine") %>%
group_by(violation_issued_fy, siteName, Permit_no.x, permittee) %>%
summarise(history_of_violations = sum(history_viol, na.rm = T), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure, na.rm = T), good_faith = sum(good_faith, na.rm = T), total_assess = sum(total_assess, na.rm = T),  total_paid = sum(total_paid, na.rm = T))
View(Novo_log)
novo_fy <- novo_w_names %>%
filter(siteName != "Table Rock Mine" & siteName != "Underwood Mine" & siteName != "Althouse Hill Mine"  & siteName != "Paugh Tract/ Potomac Camp") %>%
group_by(violation_issued_fy, siteName, Permit_no.x, permittee) %>%
summarise(history_of_violations = sum(history_viol, na.rm = T), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure, na.rm = T), good_faith = sum(good_faith, na.rm = T), total_assess = sum(total_assess, na.rm = T),  total_paid = sum(total_paid, na.rm = T))
#now I can see which fiscal year fines were issued. I decided to remove table rock mine and underwood because the numbers are so high and the fines were never paid. I can note it out if I want a total.
novo_fy <- novo_w_names %>%
filter(siteName != "Table Rock Mine" & siteName != "Underwood Mine" & siteName != "Althouse Hill Mine"  & siteName != "Paugh Tract/ Potomac Camp") %>%
group_by(violation_issued_fy) %>%
summarise(history_of_violations = sum(history_viol, na.rm = T), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure, na.rm = T), good_faith = sum(good_faith, na.rm = T), total_assess = sum(total_assess, na.rm = T),  total_paid = sum(total_paid, na.rm = T))
novo_fy <- novo_w_names %>%
filter(siteName != "Table Rock Mine" & siteName != "Underwood Mine" & siteName != "Althouse Hill Mine"  & siteName != "Paugh Tract/ Potomac Camp") %>%
group_by(violation_issued_fy) %>%
summarise(history_of_violations = sum(history_viol, na.rm = T), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure, na.rm = T), good_faith = sum(good_faith, na.rm = T), total_assess = sum(total_assess, na.rm = T),  total_paid = sum(total_paid, na.rm = T))
novo_fy <- novo_w_names %>%
filter(siteName != "Table Rock Mine" & siteName != "Underwood Mine" & siteName != "Althouse Hill Mine"  & siteName != "Paugh Tract/ Potomac Camp") %>%
group_by(violation_issued_fy, siteName, Permit_no.x, permittee) %>%
summarise(history_of_violations = sum(history_viol, na.rm = T), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure, na.rm = T), good_faith = sum(good_faith, na.rm = T), total_assess = sum(total_assess, na.rm = T),  total_paid = sum(total_paid, na.rm = T))
novo_and_fines <- novo_w_names  %>%
filter(siteName != "Table Rock Mine" & siteName != "Underwood Mine" & siteName != "Althouse Hill Mine"  & siteName != "Paugh Tract/ Potomac Camp") %>%
group_by(NOVO_num, violation_issued_fy, permittee, siteName ) %>%
#creates a count with the row name being count. The n value is the number of times it occurs
summarise(history_of_violations = sum(history_viol), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure), good_faith = sum(good_faith), total_assess = sum(total_assess),  total_paid = sum(total_paid))  %>%
arrange(desc( siteName))
#now I can see which fiscal year fines were issued. I decided to remove table rock mine and underwood and PAugh and Althouse because they are all LAOC mines...and their fines are to be handled differently. Because the numbers are so high and the fines were never paid. I can note it out if I want a total.
novo_fy <- novo_w_names %>%
filter(siteName != "Table Rock Mine" & siteName != "Underwood Mine" & siteName != "Althouse Hill Mine"  & siteName != "Paugh Tract/ Potomac Camp") %>%
group_by(violation_issued_fy, siteName, permittee) %>%
summarise(history_of_violations = sum(history_viol, na.rm = T), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure, na.rm = T), good_faith = sum(good_faith, na.rm = T), total_assess = sum(total_assess, na.rm = T),  total_paid = sum(total_paid, na.rm = T))
View(novo_fy)
novo_fy <- novo_w_names %>%
filter(siteName != "Table Rock Mine" & siteName != "Underwood Mine" & siteName != "Althouse Hill Mine"  & siteName != "Paugh Tract/ Potomac Camp") %>%
group_by( siteName, permittee) %>%
summarise(history_of_violations = sum(history_viol, na.rm = T), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure, na.rm = T), good_faith = sum(good_faith, na.rm = T), total_assess = sum(total_assess, na.rm = T),  total_paid = sum(total_paid, na.rm = T))
novo_fy <- novo_w_names %>%
#filter(siteName != "Table Rock Mine" & siteName != "Underwood Mine" & siteName != "Althouse Hill Mine"  & siteName != "Paugh Tract/ Potomac Camp") %>%
group_by( siteName, permittee) %>%
summarise(history_of_violations = sum(history_viol, na.rm = T), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure, na.rm = T), good_faith = sum(good_faith, na.rm = T), total_assess = sum(total_assess, na.rm = T),  total_paid = sum(total_paid, na.rm = T))
#now I can see which fiscal year fines were issued. I decided to remove table rock mine and underwood and PAugh and Althouse because they are all LAOC mines...and their fines are to be handled differently. Because the numbers are so high and the fines were never paid. I can note it out if I want a total.
novo_fy <- novo_w_names %>%
#filter(siteName != "Table Rock Mine" & siteName != "Underwood Mine" & siteName != "Althouse Hill Mine"  & siteName != "Paugh Tract/ Potomac Camp") %>%
group_by( siteName, permittee) %>%
#summarise(history_of_violations = sum(history_viol, na.rm = T), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure, na.rm = T), good_faith = sum(good_faith, na.rm = T), total_assess = sum(total_assess, na.rm = T),  total_paid = sum(total_paid, na.rm = T))
#so first I wanted to look at the violation number and the date and see how much each company owed per novo. Again, I'm trying to look through
novo_and_fines <- novo_w_names  %>%
filter(siteName != "Table Rock Mine" & siteName != "Underwood Mine" & siteName != "Althouse Hill Mine"  & siteName != "Paugh Tract/ Potomac Camp") %>%
group_by(NOVO_num, violation_issued_fy, permittee, siteName ) %>%
#creates a count with the row name being count. The n value is the number of times it occurs
summarise(history_of_violations = sum(history_viol), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure), good_faith = sum(good_faith), total_assess = sum(total_assess),  total_paid = sum(total_paid))  %>%
arrange(desc( siteName))
novo_and_fines <- novo_w_names  %>%
filter(siteName != "Table Rock Mine" & siteName != "Underwood Mine" & siteName != "Althouse Hill Mine"  & siteName != "Paugh Tract/ Potomac Camp") %>%
group_by(NOVO_num, violation_issued_fy, permittee, siteName )# %>%
#creates a count with the row name being count. The n value is the number of times it occurs
summarise(history_of_violations = sum(history_viol), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure), good_faith = sum(good_faith), total_assess = sum(total_assess),  total_paid = sum(total_paid))  %>%
arrange(desc( siteName))
novo_fy <- novo_w_names %>%
#filter(siteName != "Table Rock Mine" & siteName != "Underwood Mine" & siteName != "Althouse Hill Mine"  & siteName != "Paugh Tract/ Potomac Camp") %>%
group_by( siteName, permittee)
#now I can see which fiscal year fines were issued. I decided to remove table rock mine and underwood and PAugh and Althouse because they are all LAOC mines...and their fines are to be handled differently. Because the numbers are so high and the fines were never paid. I can note it out if I want a total.
novo_fy <- novo_w_names %>%
#filter(siteName != "Table Rock Mine" & siteName != "Underwood Mine" & siteName != "Althouse Hill Mine"  & siteName != "Paugh Tract/ Potomac Camp") %>%
group_by( siteName, permittee) %>%
summarise(count = n())
novo_fy <- novo_w_names %>%
#filter(siteName != "Table Rock Mine" & siteName != "Underwood Mine" & siteName != "Althouse Hill Mine"  & siteName != "Paugh Tract/ Potomac Camp") %>%
group_by( siteName, permittee) %>%
summarise(history_of_violations = sum(history_viol, na.rm = T), total_fine = sum(history_viol, seriousness_viol, negligence_viol, effect_viol_reclamation, assessment_failure, na.rm = T), good_faith = sum(good_faith, na.rm = T), total_assess = sum(total_assess, na.rm = T),  total_paid = sum(total_paid, na.rm = T))
